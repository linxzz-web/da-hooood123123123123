-- CONFIGURATION - EDIT THESE VALUES
local TARGET_USERNAME = "zdenda3030" -- The target player's username
local RISE_SPEED = 2 -- How fast to rise (studs per second)
local UNDER_OFFSET = 3 -- How many studs below the target to stay
local ITEM_NAME = "[WALLET]" -- The item name to check for
local CHECK_FREQUENCY = 1 -- How often to check inventory (seconds)

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Variables
local isUnder = false
local targetPlayer = nil
local heartbeatConnection = nil

-- Wait for LocalPlayer
repeat task.wait() until LocalPlayer and LocalPlayer.Character

-- Function to find target player
local function findTargetPlayer()
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Name:lower() == TARGET_USERNAME:lower() then
            return player
        end
    end
    return nil
end

-- DEBUG FUNCTION: Print all inventory items
local function debugInventory()
    print("=== INVENTORY DEBUG ===")
    
    -- Check Backpack
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    if backpack then
        print("Backpack items:")
        for _, item in ipairs(backpack:GetChildren()) do
            print("  - " .. item.Name .. " (" .. item.ClassName .. ")")
        end
    else
        print("No Backpack found")
    end
    
    -- Check Character
    if LocalPlayer.Character then
        print("Character items:")
        for _, item in ipairs(LocalPlayer.Character:GetChildren()) do
            if item:IsA("Tool") or item:IsA("Accessory") then
                print("  - " .. item.Name .. " (" .. item.ClassName .. ")")
            end
        end
    end
    
    -- Check PlayerGui for UI-based inventory
    local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
    if playerGui then
        print("Searching PlayerGui for inventory UI...")
        local function searchForItem(instance, depth)
            depth = depth or 0
            local indent = string.rep("  ", depth)
            for _, child in ipairs(instance:GetChildren()) do
                if child.Name == ITEM_NAME then
                    print("FOUND in GUI: " .. child:GetFullName())
                end
                searchForItem(child, depth + 1)
            end
        end
        searchForItem(playerGui)
    end
    
    print("========================")
end

-- IMPROVED: More aggressive item checking
local function hasItem(itemName)
    -- Method 1: Check Backpack (most common)
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    if backpack then
        for _, item in ipairs(backpack:GetChildren()) do
            -- Check exact name match
            if item.Name == itemName then
                print("Found in Backpack (exact match): " .. item.Name)
                return true
            end
            -- Check if itemName is contained in the name (for partial matches)
            if string.find(item.Name, itemName) then
                print("Found in Backpack (partial match): " .. item.Name)
                return true
            end
        end
    end
    
    -- Method 2: Check Character for equipped items
    if LocalPlayer.Character then
        for _, item in ipairs(LocalPlayer.Character:GetChildren()) do
            if item.Name == itemName or string.find(item.Name, itemName) then
                print("Found on Character: " .. item.Name)
                return true
            end
        end
    end
    
    -- Method 3: Check PlayerGui for UI elements (for games with GUI-based inventory)
    local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
    if playerGui then
        -- Check all descendants for the item name
        for _, descendant in ipairs(playerGui:GetDescendants()) do
            if descendant.Name == itemName or string.find(descendant.Name, itemName) then
                print("Found in GUI: " .. descendant:GetFullName())
                return true
            end
        end
    end
    
    -- Method 4: Check StarterGear (if applicable)
    local starterGear = LocalPlayer:FindFirstChild("StarterGear")
    if starterGear then
        for _, item in ipairs(starterGear:GetChildren()) do
            if item.Name == itemName or string.find(item.Name, itemName) then
                print("Found in StarterGear: " .. item.Name)
                return true
            end
        end
    end
    
    return false
end

-- Function to smoothly move player under target
local function moveUnderTarget()
    if not targetPlayer or not targetPlayer.Character then return end
    if not LocalPlayer.Character then return end
    
    local targetRoot = targetPlayer.Character:FindFirstChild("HumanoidRootPart") or targetPlayer.Character:FindFirstChild("Torso")
    local localRoot = LocalPlayer.Character:FindFirstChild("HumanoidRootPart") or LocalPlayer.Character:FindFirstChild("Torso")
    
    if not targetRoot or not localRoot then return end
    
    -- Calculate target position
    local targetPosition = Vector3.new(
        targetRoot.Position.X,
        targetRoot.Position.Y - UNDER_OFFSET,
        targetRoot.Position.Z
    )
    
    -- Smooth movement
    local currentPos = localRoot.Position
    local newY = currentPos.Y + (RISE_SPEED * 0.1)
    
    if newY >= targetPosition.Y then
        newY = targetPosition.Y
    end
    
    localRoot.CFrame = CFrame.new(currentPos.X, newY, currentPos.Z)
end

-- Function to start the effect
local function startUnder()
    if isUnder then return end
    
    targetPlayer = findTargetPlayer()
    if not targetPlayer then
        print("‚ùå Target player '" .. TARGET_USERNAME .. "' not found!")
        return
    end
    
    if not LocalPlayer.Character then
        print("‚ùå Local player has no character!")
        return
    end
    
    print("‚úÖ Starting under effect - " .. ITEM_NAME .. " NOT in inventory!")
    isUnder = true
    
    heartbeatConnection = RunService.Heartbeat:Connect(function()
        if isUnder and targetPlayer and targetPlayer.Character and LocalPlayer.Character then
            moveUnderTarget()
        end
    end)
end

-- Function to stop the effect
local function stopUnder()
    if isUnder then
        print("‚èπÔ∏è Stopping under effect - " .. ITEM_NAME .. " found in inventory!")
        isUnder = false
    end
    if heartbeatConnection then
        heartbeatConnection:Disconnect()
        heartbeatConnection = nil
    end
end

-- Main loop
spawn(function()
    print("üöÄ === UNDER SCRIPT LOADED ===")
    print("Target: " .. TARGET_USERNAME)
    print("Item to check: " .. ITEM_NAME)
    print("===============================")
    
    -- Run inventory debug once at start
    task.wait(2)
    debugInventory()
    
    while true do
        local hasWallet = hasItem(ITEM_NAME)
        
        if hasWallet and isUnder then
            stopUnder()
        elseif not hasWallet and not isUnder then
            startUnder()
        end
        
        -- Print status every 5 seconds for debugging
        if tick() % 5 < 1 then
            local status = hasWallet and "HAS" or "DOES NOT HAVE"
            print("üì¶ Inventory status: " .. status .. " " .. ITEM_NAME .. " | Effect: " .. (isUnder and "ACTIVE" or "INACTIVE"))
        end
        
        task.wait(CHECK_FREQUENCY)
    end
end)

-- Manual override: Press 'P' to toggle under effect manually
local UserInputService = game:GetService("UserInputService")
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.P then
        if isUnder then
            stopUnder()
        else
            startUnder()
        end
    elseif input.KeyCode == Enum.KeyCode.I then
        -- Press 'I' to debug inventory
        debugInventory()
    end
end)

print("‚ÑπÔ∏è Press 'I' to debug inventory | Press 'P' to manually toggle under effect")
